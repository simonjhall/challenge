CC=arm-linux-gnueabihf-gcc
CXX=arm-linux-gnueabihf-g++

INCLUDES=-I"source/brcm_usrlib/dag/vmcsx" -I"source/brcm_usrlib/dag/vmcsx/helpers/vc_image" -I"source/brcm_usrlib/dag/vmcsx/interface/vcos/pthreads" -I"source/brcm_usrlib/dag/v3d_library/inc" -I"source/brcm_usrlib/dag/v3d_library/src" -I"source/brcm_usrlib/dag/vmcsx/interface/khronos/include" -I"source/brcm_usrlib/dag/vmcsx/middleware/khronos/common" -I"source/brcm_usrlib/dag/vmcsx/vcfw/drivers/chip" -I"source/brcm_usrlib/dag/vmcsx/vcinclude"
DEFINES=-DBCG_FB_LAYOUT -DBRCM_V3D_OPT=1 -D_KHRONOS_CLIENT_LOGGING -DEGL_SERVER_SMALLINT -DBCM_COMP_USE_RELOC_HEAP -DUNIFORM_LOCATION_IS_16_BIT -D__VIDEOCORE4__ -D__DIRECT_RENDERING -DRPC_DIRECT -DRPC_DIRECT_MULTI -DNDEBUG__ -D__CC_ARM

CPPFLAGS=-c $(DEFINES) -O3 -g -marm -std=c99 -Wno-unused-variable -Wno-unused-but-set-variable -Wno-implicit-function-declaration -fgnu89-inline -Wno-unused-value -march=armv6 -mfpu=vfp -mfloat-abi=hard
CFLAGS=$(CPPFLAGS) -Wimplicit-function-declaration
LDFLAGS=-mcpu=arm1176jzf-s -mfloat-abi=hard -shared

SOURCES_C=./source/brcm_usrlib/dag/vmcsx/vcfw/rtos/common/rtos_common_mem_.c  ./source/brcm_usrlib/dag/vmcsx/vcfw/drivers/chip/vciv/2708/v3d.c  ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/2708/be_2708.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/2708/bf_2708.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/2708/path_2708.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/2708/segment_lengths_2708.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/2708/tess_2708.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/2708/vg_shader_fd_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/2708/vg_shader_md_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/2708/vg_tess_fill_shader_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/2708/vg_tess_init_shader_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/2708/vg_tess_stroke_shader_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/2708/vg_tess_term_shader_4.c  ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/image_vg.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/server_vg.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/vg_bf.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/vg_font.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/vg_hw.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/vg_mask_layer.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/vg_paint.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/vg_path.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/vg_ramp.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/vg_scissor.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/vg_segment_lengths.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/vg_set.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/vg/vg_tess.c  ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/tools/dfmt/dfmt.c  ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glxx/2708/glxx_attr_sort_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glxx/2708/glxx_hw_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glxx/2708/glxx_shader_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glxx/2708/hw_glxx.c  ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glxx/glxx_buffer.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glxx/glxx_framebuffer.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glxx/glxx_renderbuffer.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glxx/glxx_server.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glxx/glxx_server_cr.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glxx/glxx_shared.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glxx/glxx_texture.c  ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/prepro/glsl_prepro_directive.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/prepro/glsl_prepro_eval.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/prepro/glsl_prepro_expand.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/prepro/glsl_prepro_macro.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/prepro/glsl_prepro_token.c  ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/2708/glsl_allocator_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/2708/glsl_fpu_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/2708/glsl_qdisasm_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/2708/glsl_scheduler_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/2708/glsl_verify_4.c  ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/glsl_ast.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/glsl_ast_print.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/glsl_ast_visitor.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/glsl_builders.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/glsl_compiler.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/glsl_const_functions.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/glsl_dataflow.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/glsl_dataflow_print.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/glsl_dataflow_visitor.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/glsl_errors.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/glsl_fastmem.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/glsl_globals.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/glsl_header.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/glsl_intern.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/glsl_map.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/glsl_mendenhall.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/glsl_stringbuilder.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/glsl_symbols.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/lex.yy.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/glsl/y.tab.c  ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/gl20/2708/gl20_shader_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/gl20/2708/gl20_support_4.c  ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/gl20/gl20_program.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/gl20/server_gl20.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/gl20/shader_gl20.c  ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/gl11/2708/gl11_shadercache_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/gl11/2708/gl11_support_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/gl11/2708/shader_gl11.c  ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/gl11/gl11_matrix.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/gl11/server_gl11.c  ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/ext/egl_brcm_driver_monitor.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/ext/egl_brcm_global_image.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/ext/egl_brcm_global_image_id.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/ext/egl_brcm_perf_monitor.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/ext/egl_khr_image.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/ext/egl_openmaxil.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/ext/gl_oes_draw_texture.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/ext/gl_oes_egl_image.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/ext/gl_oes_query_matrix.c  ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/egl/tga/platform_egl.c  ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/egl/dispmanx/egl_platform_dispmanx.c  ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/egl/egl_disp_fps.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/egl/egl_server.c  ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/2708/bf_common.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/2708/image_2708.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/2708/interlock_2708.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/2708/khrn_copy_buffer_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/2708/khrn_fmem_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/2708/khrn_hw_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/2708/khrn_nmem_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/2708/khrn_pool_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/2708/khrn_prod_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/2708/khrn_render_state_4.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/2708/khrn_worker_4.c  ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/khrn_color.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/khrn_fleaky_map.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/khrn_image.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/khrn_interlock.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/khrn_llat.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/khrn_map.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/khrn_map_64.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/khrn_math.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/khrn_misc.c ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/khrn_tformat.c  ./source/brcm_usrlib/dag/vmcsx/interface/vcos/pthreads/vcos_pthreads.c  ./source/brcm_usrlib/dag/vmcsx/interface/vcos/generic/vcos_abort.c ./source/brcm_usrlib/dag/vmcsx/interface/vcos/generic/vcos_generic_event_flags.c ./source/brcm_usrlib/dag/vmcsx/interface/vcos/generic/vcos_generic_named_sem.c ./source/brcm_usrlib/dag/vmcsx/interface/vcos/generic/vcos_generic_reentrant_mtx.c ./source/brcm_usrlib/dag/vmcsx/interface/vcos/generic/vcos_logcat.c ./source/brcm_usrlib/dag/vmcsx/interface/vcos/generic/vcos_mem_from_malloc.c ./source/brcm_usrlib/dag/vmcsx/interface/vcos/generic/vcos_msgqueue.c  ./source/brcm_usrlib/dag/vmcsx/interface/khronos/vg/vg_client.c ./source/brcm_usrlib/dag/vmcsx/interface/khronos/vg/vg_int_mat3x3.c  ./source/brcm_usrlib/dag/vmcsx/interface/khronos/glxx/glxx_client.c  ./source/brcm_usrlib/dag/vmcsx/interface/khronos/ext/egl_brcm_driver_monitor_client.c ./source/brcm_usrlib/dag/vmcsx/interface/khronos/ext/egl_brcm_flush_client.c ./source/brcm_usrlib/dag/vmcsx/interface/khronos/ext/egl_brcm_global_image_client.c ./source/brcm_usrlib/dag/vmcsx/interface/khronos/ext/egl_brcm_perf_monitor_client.c ./source/brcm_usrlib/dag/vmcsx/interface/khronos/ext/egl_khr_image_client.c ./source/brcm_usrlib/dag/vmcsx/interface/khronos/ext/egl_khr_lock_surface_client.c ./source/brcm_usrlib/dag/vmcsx/interface/khronos/ext/egl_khr_sync_client.c ./source/brcm_usrlib/dag/vmcsx/interface/khronos/ext/egl_openmaxil_client.c ./source/brcm_usrlib/dag/vmcsx/interface/khronos/ext/gl_oes_draw_texture_client.c  ./source/brcm_usrlib/dag/vmcsx/interface/khronos/egl/brcm_egl.c ./source/brcm_usrlib/dag/vmcsx/interface/khronos/egl/egl_client.c ./source/brcm_usrlib/dag/vmcsx/interface/khronos/egl/egl_client_config.c ./source/brcm_usrlib/dag/vmcsx/interface/khronos/egl/egl_client_context.c ./source/brcm_usrlib/dag/vmcsx/interface/khronos/egl/egl_client_surface.c  ./source/brcm_usrlib/dag/vmcsx/interface/khronos/common/vcos/khrn_client_platform_vcos.c  ./source/brcm_usrlib/dag/vmcsx/interface/khronos/common/selfhosted/khrn_client_platform_selfhosted.c  ./source/brcm_usrlib/dag/vmcsx/interface/khronos/common/khrn_client.c ./source/brcm_usrlib/dag/vmcsx/interface/khronos/common/khrn_client_cache.c ./source/brcm_usrlib/dag/vmcsx/interface/khronos/common/khrn_client_global_image_map.c ./source/brcm_usrlib/dag/vmcsx/interface/khronos/common/khrn_client_pointermap.c ./source/brcm_usrlib/dag/vmcsx/interface/khronos/common/khrn_client_vector.c ./source/brcm_usrlib/dag/vmcsx/interface/khronos/common/khrn_int_hash.c ./source/brcm_usrlib/dag/vmcsx/interface/khronos/common/khrn_int_image.c ./source/brcm_usrlib/dag/vmcsx/interface/khronos/common/khrn_int_util.c  ./source/brcm_usrlib/dag/vmcsx/applications/vmcs/khronos/khronos_main.c  ./source/malloc.c

SOURCE_CPP=./source/brcm_usrlib/dag/vmcsx/interface/khronos/common/cache_cache.cpp ./source/brcm_usrlib/dag/v3d_library/src/ghw_allocator_impl.cpp ./source/brcm_usrlib/dag/v3d_library/src/ghw_composer_impl.cpp ./source/brcm_usrlib/dag/v3d_library/src/ghw_memblock.cpp ./source/brcm_usrlib/dag/vmcsx/vcfw/rtos/common/rtos_common_mem.cpp

OBJECTS_C=$(SOURCES_C:.c=.c.o)
OBJECTS_CPP=$(SOURCES_CPP:.cpp=.cpp.o)

LIBEGL=libEGL.so
LIBGLESv2=libGLESv2.so

all: $(SOURCES_C) $(SOURCE_CPP) $(LIBEGL) $(LIBGLESv2) ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/2708/dispman_connection.c

clean:
	rm -f $(OBJECTS_C) $(OBJECTS_CPP) $(LIBEGL) $(LIBGLESv2) ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/2708/dispman_connection.c.o

install: $(LIBEGL) $(LIBGLESv2)
	cp $(LIBEGL) /opt/vc/lib/
	cp $(LIBGLESv2) /opt/vc/lib/

$(LIBEGL): $(OBJECTS_C) $(OBJECTS_CPP) ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/2708/dispman_connection.c.o
	$(CC) $(LDFLAGS) $(OBJECTS_C) $(OBJECTS_CPP) ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/2708/dispman_connection.c.o -o $@

$(LIBGLESv2): glesv2.c
	$(CC) $< -o $@ -shared $(CFLAGS)

%.c.o: %.c
	$(CC) $(CFLAGS) $(INCLUDES) $< -o $@

./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/2708/dispman_connection.c.o: ./source/brcm_usrlib/dag/vmcsx/middleware/khronos/common/2708/dispman_connection.c
	$(CC) $(CFLAGS) $< -o $@ -I . -I vc/include

.cpp.o: %.cpp
	$(CXX) $(CPPFLAGS) $(INCLUDES) $< -o $@

